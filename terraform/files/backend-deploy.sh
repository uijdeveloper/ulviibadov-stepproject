#!/bin/bash

yum update
yum install docker -y
usermod -aG docker ec2-user
systemctl enable docker
systemctl start docker

yum install git -y

cat << HEREDOC > /root/.ssh/id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
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
HtQm1yEEYKsAWl1fDBk4pyKPw+A=
-----END OPENSSH PRIVATE KEY-----
HEREDOC

chmod 0400 /root/.ssh/id_rsa

mkdir -p /src/my-backend-app

cd /src/my-backend-app

cat << HEREDOC > ./UlviAbbTechKey.pem
-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEAjtseDrkCgB4UER0mKqpB8QeHqjZvATm9qXgMpyDC6BgUvb3C
NUpJ8cQsrCYOS+IxLww/mvHZtRl0o9o/CYIqq/lchH2pGXy9tSxi/kRuN4NNqIUo
4w7s94ZgWGal+97tZfZ+29G0SLzhuZzx7xiGPbxRNrKnN85hV3JfTh3q3OOm8W/O
nYQWIW6JlT1CISwtMg6wllqXjwcWHhDXTTk1zqj2u4QY4xyMhOeGGwCeFXjSwNOU
RSp3NwaM0p+OSoRYFJAyNOVvIxEv/wXsadbyQ7KQlDRxSyGCj6n1MddlMrjRUWNg
4s1sEP93wdRsh2HkVnk/fU6CoqZ4Y113s+57tQIDAQABAoIBAElU/cb8/eWaix6F
4hPAtnzuKpwbuTvd0hhugcBBNwxBYFROVqVYb0DmPTBZkLkvcaP/G5+ESweF+7Qo
0nclFJaXOQDiKK3mtNON53sy0Yk5o+HACU8VWFtv5YE7oDT9KMxQjqp0qaE1JIJN
qHveEPsb8myrpN8m2B01nurQvMGKbdzp5ZkT/gbTwrB5vvv/I8CEhyc0SKdn+EJA
7uPefh209YPunuwwW7Y+GzRhvxT15XcY9kGP59GF2WIqd+R+IWr1v16jHb/mvXby
DxBaklwjuBm7M2LrN0N9OnhM5dQIZe8gnlfkHmsqFnmn3IbYr+wqhwrkGAMgA9I+
DWF3U4ECgYEA0v73Og/FyRhrqO5ZJ5ke4XrvJx7hjR3/ede9VHG3pLDhTp1vfYfw
YrKHCbF2ZSvw9ccbqxX3i9lkP9Prgu8hZjb52R8oxQK1MAoBLaSf1RxHQbXkjiPU
cKKUc6xDqS7iH7rCgXGG635QFSKhj8DZlrMJLkpveT5PrJ4XoTu7v7ECgYEArVN+
kp0KqWyHxi8k4U9IqtJoqsiExpjmIYviLmaVK0yZzryZ70SXxzZ9RPsOtVprGIzx
x1kv5UCFvi3Wf/kxYH/7K/zlT88GYdVWB7o62jMq7fkG33g3XcHjd0hugfJ40p4N
FZ5V5s4Q6WtMkOcu7lhngT72NV2kd4f0xMX+IUUCgYBP8ku6tD888wPX/nfJiTsq
NGppaEoOLk+e2x/h3zS2Mk8senrEFb3/p6WDBrrVmtCyT78sFCa31qcliCa0decx
06LXofbQrzX3/dJ0eOwW06AsRb9UHD9ibjfRnHQGpr0HSLxqT5nPoQy29WhCD9Bi
SXQxFgMm7XVC8qQBc6CwAQKBgFvd1UiAVBZYn947PqDtFOb1fuSGQ1m/0LoXGlrd
pFK+1wbsj+pxwMCl8N+O8czNj9YDXmL6spggCsMyKG7L9Y/gRZCbCi+y2v8fw+l0
m5zrYeWgCDSJ006uZZHjoi7eBYwcmXLL6Vvb/Lq7VGm5HvbVhIbMiFLgvztbpDBn
gLrBAoGAUnK5zbgvU+NlKMfDOt5d3taGZFMCLBt3n5lTq4a+7To78YBzzS47dRfj
YfZBvZ6toB1z1GgZ4hiZJTo1Po3Ydyxw9l7PFGaI8WH7P1webGFgukOTQXftt86b
8S7ieIY/Baj9uliCAH8SizwqtI4jS7UFhzzH77rxVFQ8ByTQMbU=
-----END RSA PRIVATE KEY-----
HEREDOC

ssh-keyscan github.com >> /root/.ssh/known_hosts
git clone git@github.com:uijdeveloper/ulviibadov-stepproject.git

cd ulviibadov-stepproject/phonebook

docker build -t my-backend-app:v1.0.0 .
docker run -di -e MYSQL_URL=${msql_url} -e MYSQL_USERNAME=${msql_username} -e MYSQL_PASSWORD=${msql_password} --name my-backend-app -p 80:80 my-backend-app:v1.0.0
